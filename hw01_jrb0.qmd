---
title: "HW01"
author: "Johnny Bachrach"
format: html
editor: visual
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(knitr)
library(tidyverse)
library(kableExtra)
library(broom)
```

```{r, echo=FALSE, include=FALSE}
# Install pacman if it's not already installed
if (!require("pacman")) install.packages("pacman")

# Use pacman to install (if needed) and load the packages
pacman::p_load(pacman, tidyverse,
               nycflights13)
```

*Consider the data in the nycflights13 package.*

-   **Problem 2**: Is there a relationship between the age of a plane and its delays?

The analysis begins by processing the data by joining the "flights" data set with the "planes" data set using the unique identifier "tailnum", then distinguishing the resulting year.x and year.y variables based on their respective original data set. We also create a new variable called "plane age" by subtracting the plane's manufacture year from the year the flight took place:

```{r}
flights_planes <- left_join(flights, planes, by = "tailnum")

flights_planes <- flights_planes %>%
  rename(
    year_flight = year.x,
    year_plane = year.y
  ) %>%
  mutate(
    plane_age = ifelse(!is.na(year_plane), year_flight - year_plane, NA)
  )
```

We're then able to filter na values from the newly created data set, and create regression models that compare the plane's age to expected departure delay and expected arrival delay:

```{r}

reg_data <- flights_planes %>%
  filter(!is.na(plane_age), !is.na(dep_delay), !is.na(arr_delay))

model_dep <- lm(dep_delay ~ plane_age, reg_data)
model_arr <- lm(arr_delay ~ plane_age, reg_data)

```

As seen in the tables below, a linear regression which compared flight delays (in minutes) to plane age (in years) resulted in a statistically significant negative relationship, indicating that older planes are actually expected to experience shorter delay times than newer planes:

```{r, echo=FALSE, include=TRUE}
tidy(model_dep) %>%
  kable(digits = 3, caption = "Regression: Plane Age (In Years) vs. Departure Delays (In Minutes)")

tidy(model_arr) %>%
  kable(digits = 3, caption = "Regression: Plane Age (In Years) vs. Arrival Delays (In Minutes)")

```


Specifically, departure delays are expected to *_decrease_* by .096 minutes for every additional year of age for a given aircraft, while arrival delays are expected to decrease by .124 minutes. While the magnitude of this expected difference is relatively small, it does indicate that a 20 year old plane is expected to be delayed between 2 and 2.5 minutes fewer than a brand new plane.

-   **Problem 3**: Find the 10 days of the year that have the highest median departure delay, then select all flights from those 10 days.

Using the previously created data set, we can group the data by month and day, find the median departure delay for each day of the year, then sort the data in descending order of delay. We then select the top 10 entries using head().

```{r, echo=TRUE, include=TRUE}
group_by(flights_planes, month, day) %>%
  summarize(
    median_delay = median(dep_delay, na.rm=T),
    .groups = "drop"
  ) %>%
  arrange(desc(median_delay)) %>%
  head(10) %>%
  kable() %>%
  kable_styling(full_width=FALSE,
        position="center")
```

We find that March 8th was the day that experienced the higest median delay - 58 minutes. A Google search reveals that the Northeast experienced [heavy snowstorms](https://www.cnn.com/2013/03/08/travel/weather-airports) that day which resulted in hundreds of flight delays and cancelations.